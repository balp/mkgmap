<?xml version="1.0"?>
<!--
    File: build.xml
    
    Copyright (C) 2006 Steve Ratcliffe
    
     This program is free software; you can redistribute it and/or modify
     it under the terms of the GNU General Public License version 2 as
     published by the Free Software Foundation.
    
     This program is distributed in the hope that it will be useful,
     but WITHOUT ANY WARRANTY; without even the implied warranty of
     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
     GNU General Public License for more details.
    
    
    Author: Steve Ratcliffe
    Create date: 26 Nov 2006
-->
<project name="mkgmap" default="build" basedir=".">

	<!-- Init -->
  <property name="top" value="."/>

	<property file="${top}/external.properties"/>

  <property name="build" value="build"/>
  <property name="dist" value="dist"/>
  <property name="build.classes" value="${build}/classes"/>
  <property name="src" value="src"/>
  <property name="doc" value="doc"/>
  <property name="javadoc" value="${doc}/api"/>
  <property name="resources" value="resources"/>

  <path id="main">
    <fileset dir="${log4j.lib}" includes="${log4j.jars}" />
    <pathelement location="${build.classes}" />
  </path>

	<!-- Prepare - make all the directories -->
	<target name="prepare">
		<mkdir dir="${build.classes}" />
	</target>

  <target name="compile" depends="prepare" description="main compilation">

    <javac srcdir="${src}" destdir="${build.classes}" debug="true">
      <include name="**/*.java" />
      <classpath refid="main"/>
    </javac>
  </target>

  <target name="javadoc" description="Create the javadoc">
    <mkdir dir="doc"/>
    <javadoc destdir="${javadoc}">

      <fileset dir="${src}" includes="**/*.java"/>
      <classpath refid="main"/>
    </javadoc>
  </target>


  <target name="dist" depends="build, javadoc"
          description="Make the distribution area">

    <mkdir dir="${dist}"/>
		<mkdir dir="${dist}/doc/api"/>

		<!-- We need log4j at the moment -->
    <delete file="${build.classes}/log4j.properties"/>
		<copy file="${resources}/log4j-dist.properties"
			tofile="${build.classes}/log4j.properties" />

		<!-- we need the log4j library at present -->
		<copy file="${log4j.lib}/${log4j.jars}" tofile="${dist}/log4j.jar"/>
    
    <!-- Make the jar -->
    <jar basedir="${build.classes}" jarfile="${dist}/mkgmap.jar"
        manifest="${resources}/MANIFEST.MF">
      <include name="**/*.class"/>
      <include name="log4j.properties"/>
    </jar>

		<!-- Copy in the javadoc -->
		<copy todir="${dist}/doc/api" >
      <fileset dir="${javadoc}"/>
    </copy>

    <!-- Copy the source code -->
    <copy todir="${dist}/src" >
      <fileset dir="${src}"/>
    </copy>

		<!-- misc -->
    <copy todir="${dist}" >
			<fileset dir="${basedir}">
				<include name="README"/>
				<include name="LICENCE*"/>
				<include name="build.xml"/>
				<include name="external.properties"/>
				<include name="resources/*"/>
			</fileset>
		</copy>
  </target>

  <!-- Clean everything -->
	<target name="clean">
		<delete dir="${build}" />
	</target>

	<!-- Clobber all generated and built files -->
	<target name="clobber" depends="clean">
		<delete dir="${dist}" />
  </target>

	<!-- Main -->
  <target name="build" depends="compile" >
    <copy file="${resources}/log4j.properties" todir="${build.classes}"/>
  </target>

	<target name="rebuild" depends="clean, build" />

</project>

